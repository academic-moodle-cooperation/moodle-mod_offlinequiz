YUI.add("moodle-mod_offlinequiz-toolboxes",function(c,a){var e,t,i,o="activityinstance",u="editinstructions",f="editor_displayed",l="hidden",s="editing_show",_="titleeditor",m={ACTIONAREA:".actions",ACTIONLINKTEXT:".actionlinktext",ACTIVITYACTION:"a.cm-edit-action[data-action], a.editing_maxmark",ACTIVITYFORM:"span.instancemaxmarkcontainer form",ACTIVITYICON:"img.activityicon",ACTIVITYINSTANCE:"."+o,ACTIVITYLINK:"."+o+" > a",ACTIVITYLI:"li.activity",ACTIVITYMAXMARK:"input[name=maxmark]",COMMANDSPAN:".commands",CONTENTAFTERLINK:"div.contentafterlink",CONTENTWITHOUTLINK:"div.contentwithoutlink",DESELECTALL:".deselectall",EDITMAXMARK:"a.editing_maxmark",HIDE:"a.editing_hide",HIGHLIGHT:"a.editing_highlight",INSTANCENAME:"span.instancename",INSTANCEMAXMARK:"span.instancemaxmark",MODINDENTDIV:".mod-indent",MODINDENTOUTER:".mod-indent-outer",NUMQUESTIONS:".numberofquestions",PAGECONTENT:"div#page-content",PAGELI:"li.page",SECTIONUL:"ul.section",SELECTMULTIPLECHECKBOX:".offlinequizbulkcopyform input[type^=checkbox], .select-multiple-checkbox",SELECTALL:".selectall",SELECTALLCHECKBOX:".select-all-checkbox",SHOW:"a."+s,SHOWHIDE:"a.editing_showhide",SLOTLI:"li.slot",SUMMARKS:".mod_offlinequiz_summarks"},n=c.one(document.body);M.mod_offlinequiz=M.mod_offlinequiz||{},c.extend(e=function(){e.superclass.constructor.apply(this,arguments)},c.Base,{send_request:function(e,o,n,t){var i,a,s,l,r;for(a in e=e||{},i=this.get("config").pageparams)e[a]=i[a];if(e.sesskey=M.cfg.sesskey,e.courseid=this.get("courseid"),e.offlinequizid=this.get("offlinequizid"),e.offlinegroupid=this.get("offlinegroupid"),s=M.cfg.wwwroot+this.get("ajaxurl"),l=[],r={method:"POST",data:e,on:{success:function(e,t){try{(l=c.JSON.parse(t.responseText)).error&&new M.core.ajaxException(l)}catch(i){}l.hasOwnProperty("newsummarks")&&c.one(m.SUMMARKS).setHTML(l.newsummarks),l.hasOwnProperty("newnumquestions")&&c.one(m.NUMQUESTIONS).setHTML(M.util.get_string("numquestionsx","offlinequiz",l.newnumquestions)),n&&c.bind(n,this,l)(),o&&window.setTimeout(function(){o.hide()},400)},failure:function(e,t){o&&o.hide(),new M.core.ajaxException(t)}},context:this},t)for(a in t)r[a]=t[a];return o&&o.show(),c.io(s,r),this}},{NAME:"mod_offlinequiz-toolbox",ATTRS:{courseid:{value:0},offlinequizid:{value:0},offlinegroupid:{value:0},ajaxurl:{value:null},config:{value:{}}}}),c.extend(t=function(){t.superclass.constructor.apply(this,arguments)},e,{editmaxmarkevents:[],NODE_PAGE:1,NODE_SLOT:2,NODE_JOIN:3,initializer:function(){M.mod_offlinequiz.offlinequizbase.register_module(this),n.delegate("key",this.handle_data_action,"down:enter",m.ACTIVITYACTION,this),c.delegate("click",this.handle_data_action,n,m.ACTIVITYACTION,this),this.initialise_select_multiple()},initialise_select_multiple:function(){c.all(m.SELECTALL).on("click",function(e){e.preventDefault(),c.all(m.SELECTMULTIPLECHECKBOX).set("checked","checked"),c.all(m.SELECTALLCHECKBOX).set("checked","checked")}),c.all(m.DESELECTALL).on("click",function(e){e.preventDefault(),c.all(m.SELECTMULTIPLECHECKBOX).set("checked",""),c.all(m.SELECTALLCHECKBOX).set("checked","")}),c.all(m.SELECTALLCHECKBOX).on("click",function(e){e.target._node.checked?c.all(m.SELECTMULTIPLECHECKBOX).set("checked","checked"):c.all(m.SELECTMULTIPLECHECKBOX).set("checked","")})},handle_data_action:function(e){var t=e.target,i=(t=t.test("a")?t:t.ancestor(m.ACTIVITYACTION)).getData("action"),o=t.ancestor(m.ACTIVITYLI);if(t.test("a")&&i&&o)switch(i){case"editmaxmark":this.edit_maxmark(e,t,o,i);break;case"delete":this.delete_with_confirmation(e,t,o,i);break;case"addpagebreak":case"removepagebreak":this.update_page_break(e,t,o,i)}},add_spinner:function(e){e=e.one(m.ACTIONAREA);return e?M.util.add_spinner(c,e):null},delete_with_confirmation:function(e,t,i){var o;return e.preventDefault(),o=i,e=M.util.get_string("pluginname","qtype_"+o.getAttribute("class").match(/qtype_([^\s]*)/)[1]),i=M.util.get_string("confirmremovequestion","offlinequiz",e),new M.core.confirm({question:i,modal:!0}).on("complete-yes",function(){var e=this.add_spinner(o),t={"class":"resource",action:"DELETE",id:c.Moodle.mod_offlinequiz.util.slot.getId(o)};this.send_request(t,e,function(e){e.deleted?(c.Moodle.mod_offlinequiz.util.slot.remove(o),this.reorganise_edit_page(),M.core.actionmenu&&M.core.actionmenu.instance&&M.core.actionmenu.instance.hideMenu()):window.location.reload(!0)})},this),this},edit_maxmark:function(e,d,o){var n,t=c.Moodle.mod_offlinequiz.util.slot.getId(o),i=o.one(m.INSTANCEMAXMARK),a=o.one(m.ACTIVITYINSTANCE),s=i.get("firstChild").get("data"),l=s,r=i,i={"class":"resource",field:"getmaxmark",id:t};e.preventDefault(),this.send_request(i,null,function(e){var t,i;M.core.actionmenu&&M.core.actionmenu.instance&&M.core.actionmenu.instance.hideMenu(),e.instancemaxmark&&(l=e.instancemaxmark),e=c.Node.create('<form action="#" />'),t=c.Node.create('<span class="'+u+'" id="id_editinstructions" />').set("innerHTML",M.util.get_string("edittitleinstructions","moodle")),i=c.Node.create('<input name="maxmark" type="text" class="'+_+'" />').setAttrs({value:l,autocomplete:"off","aria-describedby":"id_editinstructions",maxLength:"12",size:parseInt(this.get("config").questiondecimalpoints,10)+2}),e.appendChild(i),e.setData("anchor",r),a.insert(t,"before"),r.replace(e),right_to_left(),o.addClass(f),i.focus().select(),n=i.on("blur",this.edit_maxmark_cancel,this,o,!1),this.editmaxmarkevents.push(n),n=i.on("key",this.edit_maxmark_cancel,"esc",this,o,!0),this.editmaxmarkevents.push(n),n=e.on("submit",this.edit_maxmark_submit,this,o,s),this.editmaxmarkevents.push(n)})},edit_maxmark_submit:function(e,t,i){var o;e.preventDefault(),e=c.Lang.trim(t.one(m.ACTIVITYFORM+" "+m.ACTIVITYMAXMARK).get("value")),o=this.add_spinner(t),this.edit_maxmark_clear(t),t.one(m.INSTANCEMAXMARK).setContent(e),null!==e&&""!==e&&e!==i&&(i={"class":"resource",field:"updatemaxmark",maxmark:e,id:c.Moodle.mod_offlinequiz.util.slot.getId(t)},this.send_request(i,o,function(e){e.instancemaxmark&&t.one(m.INSTANCEMAXMARK
).setContent(e.instancemaxmark)}))},edit_maxmark_cancel:function(e,t,i){i&&e.preventDefault(),this.edit_maxmark_clear(t)},edit_maxmark_clear:function(e){new c.EventHandle(this.editmaxmarkevents).detach();var t=e.one(m.ACTIVITYFORM),i=e.one("#id_editinstructions");t&&t.replace(t.getData("anchor")),i&&i.remove(),e.removeClass(f),c.later(100,this,function(){e.one(m.EDITMAXMARK).focus()}),c.one("input[name=maxmark")||c.one("body").append('<input type="text" name="maxmark" style="display: none">')},update_page_break:function(e,t,i,o){var n;return e.preventDefault(),e=i.next("li.activity.slot"),n="removepagebreak"===o?1:2,e={"class":"resource",field:"updatepagebreak",id:c.Moodle.mod_offlinequiz.util.slot.getId(e),value:n},this.send_request(e,null,function(e){e.slots&&("addpagebreak"===o?c.Moodle.mod_offlinequiz.util.page.add(i):(e=i.next(c.Moodle.mod_offlinequiz.util.page.SELECTORS.PAGE),c.Moodle.mod_offlinequiz.util.page.remove(e,!0)),this.reorganise_edit_page())}),this},reorganise_edit_page:function(){c.Moodle.mod_offlinequiz.util.slot.reorderSlots(),c.Moodle.mod_offlinequiz.util.slot.reorderPageBreaks(),c.Moodle.mod_offlinequiz.util.page.reorderPages()},NAME:"mod_offlinequiz-resource-toolbox",ATTRS:{courseid:{value:0},offlinequizid:{value:0},offlinegroupid:{value:0}}}),M.mod_offlinequiz.resource_toolbox=null,M.mod_offlinequiz.init_resource_toolbox=function(e){return M.mod_offlinequiz.resource_toolbox=new t(e),M.mod_offlinequiz.resource_toolbox},c.extend(i=function(){i.superclass.constructor.apply(this,arguments)},e,{editsectionevents:[],initializer:function(){M.mod_offlinequiz.offlinequizbase.register_module(this),n.delegate("key",this.handle_data_action,"down:enter",m.ACTIVITYACTION,this),c.delegate("click",this.handle_data_action,n,m.ACTIVITYACTION,this),c.delegate("change",this.handle_data_action,n,m.EDITSHUFFLEQUESTIONSACTION,this)},toggle_hide_section:function(e){var t,i,n,o,a,s;e.preventDefault(),t=e.target.ancestor(M.mod_offlinequiz.format.get_section_selector(c)),s=(e=e.target.ancestor("a",!0)).one("img"),a=t.hasClass(l)?(t.removeClass(l),i=1,n="show","hide"):(t.addClass(l),i=0,n="hide","show"),o=M.util.get_string(a+"fromothers","format_"+this.get("format")),s.setAttrs({alt:o,src:M.util.image_url("i/"+a)}),e.set("title",o),a={"class":"section",field:"visible",id:c.Moodle.core_course.util.section.getId(t.ancestor(M.mod_offlinequiz.edit.get_section_wrapper(c),!0)),value:i},(s=M.util.add_lightbox(c,t)).show(),this.send_request(a,s,function(o){t.all(m.ACTIVITYLI).each(function(e){var t=e.one(m.SHOW)?e.one(m.SHOW):e.one(m.HIDE),i=c.Moodle.mod_offlinequiz.util.slot.getId(e);-1!==c.Array.indexOf(o.resourcestotoggle,""+i)&&M.mod_offlinequiz.resource_toolbox.handle_resource_dim(t,e,n)},this)})}},{NAME:"mod_offlinequiz-section-toolbox",ATTRS:{courseid:{value:0},offlinequizid:{value:0},offlinegroupid:{value:0},format:{value:"topics"}}}),M.mod_offlinequiz.init_section_toolbox=function(e){return new i(e)}},"@VERSION@",{requires:["base","node","event","event-key","io","moodle-mod_offlinequiz-offlinequizbase","moodle-mod_offlinequiz-util-slot","moodle-core-notification-ajaxexception"]});