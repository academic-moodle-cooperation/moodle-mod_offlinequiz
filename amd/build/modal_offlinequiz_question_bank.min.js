define("mod_offlinequiz/modal_offlinequiz_question_bank",["exports","./add_question_modal","core/fragment","core_form/changechecker","core/modal_events","core/notification"],(function(_exports,_add_question_modal,Fragment,FormChangeChecker,ModalEvents,Notification){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_add_question_modal=(obj=_add_question_modal)&&obj.__esModule?obj:{default:obj},Fragment=_interopRequireWildcard(Fragment),FormChangeChecker=_interopRequireWildcard(FormChangeChecker),ModalEvents=_interopRequireWildcard(ModalEvents),Notification=_interopRequireWildcard(Notification);const SELECTORS={ADD_TO_QUIZ_CONTAINER:"td.addtoofflinequizaction",ANCHOR:"a[href]",PREVIEW_CONTAINER:"td.previewquestionaction",ADD_QUESTIONS_FORM:"form#questionsubmit",SORTERS:".sorters",SWITCH_TO_OTHER_BANK:'button[data-action="switch-question-bank"]',NEW_BANKMOD_ID:"data-newmodid",BANK_SEARCH:"#searchbanks",GO_BACK_BUTTON:'button[data-action="go-back"]',ADD_ON_PAGE_FORM_ELEMENT:'input[name="addonpage"]',CMID_FORM_ELEMENT:'form#questionsubmit input[name="cmid"]'};class ModalOfflinequizQuestionBank extends _add_question_modal.default{static init(contextId,bankCmId,quizCmId){document.addEventListener("click",(e=>{const trigger=e.target.closest('.menu [data-action="questionbank"]');trigger&&(e.preventDefault(),ModalOfflinequizQuestionBank.create({contextId:contextId,quizCmId:quizCmId,bankCmId:bankCmId,title:trigger.dataset.header,addOnPage:trigger.dataset.addonpage,templateContext:{hidden:!0},large:!0}))}))}show(){return this.reloadBodyContent(window.location.search),super.show(this)}reloadBodyContent(querystring){this.hideFooter(),this.setTitle(this.originalTitle),this.setBody(Fragment.loadFragment("mod_offlinequiz","offlinequiz_question_bank",this.getContextId(),{querystring:querystring,quizcmid:this.quizCmId,bankcmid:this.bankCmId}))}handleAddToOfflinequizEvent(e,anchorElement){const href=new URL(anchorElement.getAttribute("href"));href.searchParams.set("addonpage",this.getAddOnPageId()),href.searchParams.set("cmid",this.quizCmId),anchorElement.setAttribute("href",href)}registerEventListeners(){super.registerEventListeners(this),this.getModal().on("submit",SELECTORS.ADD_QUESTIONS_FORM,(e=>{const formElement=e.currentTarget;document.querySelector(SELECTORS.ADD_ON_PAGE_FORM_ELEMENT).setAttribute("value",this.getAddOnPageId()),document.querySelector(SELECTORS.CMID_FORM_ELEMENT).setAttribute("value",this.quizCmId);const actionUrl=new URL(formElement.getAttribute("action"));actionUrl.searchParams.set("cmid",this.quizCmId),formElement.setAttribute("action",actionUrl.toString())})),this.getModal().on("click",SELECTORS.SWITCH_TO_OTHER_BANK,(()=>{this.handleSwitchBankContentReload(SELECTORS.BANK_SEARCH).then((function(ModalOfflinequizQuestionBank){var _document$querySelect;null===(_document$querySelect=document.querySelector(SELECTORS.BANK_SEARCH))||void 0===_document$querySelect||_document$querySelect.addEventListener("change",(e=>{const bankCmId=e.currentTarget.value;bankCmId>0&&(ModalOfflinequizQuestionBank.bankCmId=bankCmId,ModalOfflinequizQuestionBank.reloadBodyContent(window.location.search))})),document.querySelector(SELECTORS.GO_BACK_BUTTON).addEventListener("click",(e=>{ModalOfflinequizQuestionBank.bankCmId=e.currentTarget.value,ModalOfflinequizQuestionBank.reloadBodyContent(window.location.search)}))})).catch(Notification.exception)})),this.getModal().on("click",SELECTORS.ANCHOR,(e=>{const anchorElement=e.currentTarget;if(anchorElement.closest(SELECTORS.ADD_TO_OFFLINEQUIZ_CONTAINER))this.handleAddToOfflinequizEvent(e,anchorElement);else if(!anchorElement.closest(SELECTORS.PREVIEW_CONTAINER)&&!anchorElement.closest(SELECTORS.SORTERS)){if(anchorElement.closest("a["+SELECTORS.NEW_BANKMOD_ID+"]")){this.bankCmId=anchorElement.getAttribute(SELECTORS.NEW_BANKMOD_ID);const url=new URL(location.href);url.searchParams.delete("filter"),history.pushState({},"",url)}e.preventDefault(),this.reloadBodyContent(anchorElement.search)}})),this.getRoot().on(ModalEvents.bodyRendered,(()=>{FormChangeChecker.disableAllChecks()}))}}return _exports.default=ModalOfflinequizQuestionBank,function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(ModalOfflinequizQuestionBank,"TYPE","mod_offlinequiz-offlinequiz-question-bank"),ModalOfflinequizQuestionBank.registerModalType(),_exports.default}));

//# sourceMappingURL=modal_offlinequiz_question_bank.min.js.map